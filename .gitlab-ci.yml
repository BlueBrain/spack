stages:
  - setup
  - compilers
  - externals
  - applications
  - checks

.spack_job:
  variables:
    DEPLOYMENT_ROOT: "/gpfs/bbp.cscs.ch/ssd/apps/hpc/jenkins"
    DEPLOYMENT_UPSTREAM: "$DEPLOYMENT_ROOT"
  rules:
    - if: '$CI_MERGE_REQUEST_SOURCE_BRANCH_NAME'
      variables:
        DEPLOYMENT_ROOT: "/gpfs/bbp.cscs.ch/ssd/apps/hpc/jenkins/pulls/$CI_MERGE_REQUEST_IID"
      when: always
    - if: '$CI_COMMIT_REF_NAME == "transition-g2g"'  # $CI_DEFAULT_BRANCH
      when: always
    - when: never

prepare_spack:
  extends: .spack_job
  stage: setup
  script:
    - env|grep DEPLOYMENT_
